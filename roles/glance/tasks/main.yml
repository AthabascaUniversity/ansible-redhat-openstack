---
# Tasks for the glance controller node

- name: Install glance OpenStack  components
  yum: name=openstack-glance state=installed
  tags: install       

- name: Check glance OpenStack packages
  rpm: name=openstack-glance state=installed
  tags: check       

- name: Setup DB for glance
  shell: /usr/bin/openstack-db --init --service glance -p {{ glance_db_pass }} -r " " -y 
         creates=/var/lib/mysql/glance
  tags: setup       

- name: Copy configuration files for glance
  template: src=glance-api.conf.j2 dest=/etc/glance/glance-api.conf
  notify: restart glance
  tags: setup       

- name: Copy configuration files for glance
  template: src=glance-registry.conf.j2 dest=/etc/glance/glance-registry.conf
  notify: restart glance
  tags: setup       

- name: DB sync for Glance
  shell: /usr/bin/glance-manage db_sync; touch /etc/glance/db.synced
         creates=/etc/glance/db.synced
  tags: setup       

- name: start the glance services
  service: name={{ item }} state=started enabled=yes
  with_items:
   - openstack-glance-api
   - openstack-glance-registry
  tags: setup       

